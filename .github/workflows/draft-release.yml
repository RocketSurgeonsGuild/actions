name: Draft Release

on:
  push:
    branches:
      - master

jobs:
  build:
    name: 'Release'
    runs-on: ubuntu-18.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: 'Generate changelog'
        id: generate-changelog
        uses: heinrichreimer/action-github-changelog-generator@v2
        with:
          issues: 'true'
          pullRequests: 'true'
          filterByMilestone: 'true'
          author: 'true'
          unreleased: 'true'
          unreleasedLabel: 'true'
          excludeLabels: ':family: duplicate,:grey_question: question,:lock: wontfix,:shipit: merge,:x: invalid'
          breakingLabel: 'ğŸ’¥ Breaking Changes ğŸ’¥'
          breakingLabels: ':boom: breaking change'
          enhancementLabel: 'ğŸš€ Features ğŸš€'
          enhancementLabels: ':fire: enhancement,:rocket: feature'
          bugsLabel: 'ğŸ Bug Fixes ğŸ'
          bugLabels: ':beetle: bug'
          deprecatedLabel: 'ğŸš§ Deprecated ğŸš§'
          deprecatedLabels: ':construction: deprecated'
          removedLabel: 'ğŸ—‘ Removed ğŸ—‘'
          removedLabels: ':wastebasket: removed'
          securityLabel: 'ğŸ— Security ğŸ—'
          securityLabels: ':old_key: security'
          issuesLabel: 'ğŸ“‹ Closed Issues ğŸ“‹'
          prLabel: 'ğŸ—ƒ Pull Requests ğŸ—ƒ'
          futureRelease: 'true'
          releaseBranch: 'true'
          onlyLastTag: 'true'
          stripHeaders: 'true'
          stripGeneratorNotice: 'true'
      - name: 'Create GitHub release'
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # This token is provided by Actions, you do not need to create your own token
        with:
          tag_name: ${{ github.ref }}
          release_name: Release ${{ github.ref }}
          body: ${{ steps.generate-changelog.outputs.changelog }}
          draft: true
          prerelease: false
