name: Draft Release

on:
  push:
    branches:
      - master

jobs:
  draft_release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Fetch all history for all tags and branches
        run: git fetch --prune --unshallow
      - name: Install GitVersion
        uses: gittools/actions/gitversion/setup@master
        with:
          versionSpec: '5.x'
      - name: Use GitVersion
        id: gitversion
        uses: gittools/actions/gitversion/execute@master
      - name: Install GitReleaseManager
        uses: gittools/actions/gitreleasemanager/setup@master
        with:
          versionSpec: '0.11.x'
      - name: Get Repo and Owner
        shell: pwsh
        id: repository
        run: |
          $parts = $ENV:GITHUB_REPOSITORY.Split('/')
          echo "::set-output name=owner::$($parts[0])"
          echo "::set-output name=repository::$($parts[1])"
      - name: Create Draft Release
        shell: pwsh
        run: |
          dotnet gitreleasemanager create `
            -o ${{ steps.repository.outputs.owner }}
            -r ${{ steps.repository.outputs.repository }}
            -t ${{ secrets.GITHUB_TOKEN }} `
            -m v${{ steps.gitversion.outputs.majorMinorPatch }}
